<!doctype html>

<html
  lang="vi"
  class="layout-menu-fixed layout-compact"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Cài đặt - Tool Craw Data Đa Luồng</title>

    <meta name="description" content="Cài đặt hệ thống crawler" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="../assets/vendor/fonts/iconify-icons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="../assets/vendor/css/core.css" />
    <link rel="stylesheet" href="../assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>
    <script src="../assets/js/config.js"></script>
  </head>

  <body>
    <!-- Layout sẽ được render vào đây -->
    <div id="app-layout"></div>

    <!-- Core JS -->
    <script src="../assets/vendor/libs/jquery/jquery.js"></script>
    <script src="../assets/vendor/libs/popper/popper.js"></script>
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="../assets/vendor/js/menu.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/common.js"></script>
    <script src="../assets/js/layout.js"></script>

    <!-- Page JS -->
    <script>
      // Khởi tạo layout manager
      const layoutManager = new LayoutManager();
      
      // Nội dung trang Settings
      const pageContent = `
        <!-- Header -->
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="d-flex align-items-start row">
                <div class="col-sm-7">
                  <div class="card-body">
                    <h5 class="card-title text-primary mb-3">⚙️ Cài đặt hệ thống</h5>
                    <p class="mb-6">
                      Cấu hình và quản lý các thiết lập của hệ thống crawler.<br />
                      Tùy chỉnh tham số thu thập dữ liệu và cài đặt chung.
                    </p>
                  </div>
                </div>
                <div class="col-sm-5 text-center text-sm-left">
                  <div class="card-body pb-0 px-0 px-md-6">
                    <img
                      src="../assets/img/illustrations/man-with-laptop.png"
                      height="175"
                      alt="Settings" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- System Information -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">Thông tin hệ thống</h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-3 mb-3">
                    <div class="d-flex align-items-center">
                      <div class="avatar flex-shrink-0 me-3">
                        <span class="avatar-initial rounded bg-label-primary">
                          <i class="bx bx-server"></i>
                        </span>
                      </div>
                      <div>
                        <h6 class="mb-0">Server Status</h6>
                        <small class="text-success">Đang hoạt động</small>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="d-flex align-items-center">
                      <div class="avatar flex-shrink-0 me-3">
                        <span class="avatar-initial rounded bg-label-info">
                          <i class="bx bx-globe"></i>
                        </span>
                      </div>
                      <div>
                        <h6 class="mb-0">Website đang theo dõi</h6>
                        <small class="text-info" id="totalSites">11</small>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="d-flex align-items-center">
                      <div class="avatar flex-shrink-0 me-3">
                        <span class="avatar-initial rounded bg-label-success">
                          <i class="bx bx-data"></i>
                        </span>
                      </div>
                      <div>
                        <h6 class="mb-0">Dữ liệu đã thu thập</h6>
                        <small class="text-success" id="totalData">Đang tải...</small>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="d-flex align-items-center">
                      <div class="avatar flex-shrink-0 me-3">
                        <span class="avatar-initial rounded bg-label-warning">
                          <i class="bx bx-time"></i>
                        </span>
                      </div>
                      <div>
                        <h6 class="mb-0">Thời gian hoạt động</h6>
                        <small class="text-warning" id="uptime">Đang tải...</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Tabs -->
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="settingsTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">
                      <i class="bx bx-cog me-1"></i>Cài đặt chung
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="crawler-tab" data-bs-toggle="tab" data-bs-target="#crawler" type="button" role="tab">
                      <i class="bx bx-data me-1"></i>Cài đặt Crawler
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab">
                      <i class="bx bx-table me-1"></i>Quản lý dữ liệu
                    </button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="system-tab" data-bs-toggle="tab" data-bs-target="#system" type="button" role="tab">
                      <i class="bx bx-shield me-1"></i>Hệ thống
                    </button>
                  </li>
                </ul>
              </div>
              <div class="card-body">
                <div class="tab-content" id="settingsTabsContent">
                  <!-- General Settings -->
                  <div class="tab-pane fade show active" id="general" role="tabpanel">
                    <form id="generalSettingsForm">
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label for="appName" class="form-label">Tên ứng dụng</label>
                          <input type="text" class="form-control" id="appName" value="Tool Craw Data Đa Luồng">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="language" class="form-label">Ngôn ngữ</label>
                          <select class="form-select" id="language">
                            <option value="vi" selected>Tiếng Việt</option>
                            <option value="en">English</option>
                          </select>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="timezone" class="form-label">Múi giờ</label>
                          <select class="form-select" id="timezone">
                            <option value="Asia/Ho_Chi_Minh" selected>Asia/Ho_Chi_Minh</option>
                            <option value="UTC">UTC</option>
                          </select>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="dateFormat" class="form-label">Định dạng ngày</label>
                          <select class="form-select" id="dateFormat">
                            <option value="dd/mm/yyyy" selected>dd/mm/yyyy</option>
                            <option value="mm/dd/yyyy">mm/dd/yyyy</option>
                            <option value="yyyy-mm-dd">yyyy-mm-dd</option>
                          </select>
                        </div>
                      </div>
                      <button type="submit" class="btn btn-primary">
                        <i class="bx bx-save me-1"></i>Lưu cài đặt
                      </button>
                    </form>
                  </div>

                  <!-- Crawler Settings -->
                  <div class="tab-pane fade" id="crawler" role="tabpanel">
                    <form id="crawlerSettingsForm">
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label for="maxPages" class="form-label">Số trang tối đa</label>
                          <input type="number" class="form-control" id="maxPages" value="5" min="1" max="50">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="perPage" class="form-label">Sản phẩm mỗi trang</label>
                          <input type="number" class="form-control" id="perPage" value="20" min="1" max="100">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="retryCount" class="form-label">Số lần thử lại</label>
                          <input type="number" class="form-control" id="retryCount" value="3" min="1" max="10">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="timeout" class="form-label">Timeout (giây)</label>
                          <input type="number" class="form-control" id="timeout" value="30" min="5" max="300">
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="orderBy" class="form-label">Sắp xếp theo</label>
                          <select class="form-select" id="orderBy">
                            <option value="date" selected>Ngày</option>
                            <option value="price">Giá</option>
                            <option value="name">Tên</option>
                          </select>
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="order" class="form-label">Thứ tự</label>
                          <select class="form-select" id="order">
                            <option value="desc" selected>Giảm dần</option>
                            <option value="asc">Tăng dần</option>
                          </select>
                        </div>
                      </div>
                      <button type="submit" class="btn btn-primary">
                        <i class="bx bx-save me-1"></i>Lưu cài đặt
                      </button>
                    </form>
                  </div>

                  <!-- Data Management -->
                  <div class="tab-pane fade" id="data" role="tabpanel">
                    <div class="row">
                      <div class="col-md-6 mb-4">
                        <div class="card h-100">
                          <div class="card-header">
                            <h6 class="card-title mb-0">Dọn dẹp dữ liệu</h6>
                          </div>
                          <div class="card-body">
                            <p class="card-text">Xóa dữ liệu cũ và không cần thiết để giải phóng dung lượng.</p>
                            <button class="btn btn-warning" onclick="cleanupData()">
                              <i class="bx bx-trash me-1"></i>Dọn dẹp dữ liệu
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6 mb-4">
                        <div class="card h-100">
                          <div class="card-header">
                            <h6 class="card-title mb-0">Sao lưu dữ liệu</h6>
                          </div>
                          <div class="card-body">
                            <p class="card-text">Tạo bản sao lưu toàn bộ dữ liệu hệ thống.</p>
                            <button class="btn btn-info" onclick="backupData()">
                              <i class="bx bx-download me-1"></i>Tạo sao lưu
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- System -->
                  <div class="tab-pane fade" id="system" role="tabpanel">
                    <div class="row">
                      <div class="col-md-6 mb-4">
                        <div class="card h-100">
                          <div class="card-header">
                            <h6 class="card-title mb-0">Khởi động lại hệ thống</h6>
                          </div>
                          <div class="card-body">
                            <p class="card-text">Khởi động lại server để áp dụng các thay đổi.</p>
                            <button class="btn btn-warning" onclick="restartSystem()">
                              <i class="bx bx-refresh me-1"></i>Khởi động lại
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6 mb-4">
                        <div class="card h-100">
                          <div class="card-header">
                            <h6 class="card-title mb-0">Cập nhật hệ thống</h6>
                          </div>
                          <div class="card-body">
                            <p class="card-text">Kiểm tra và cập nhật phiên bản mới nhất.</p>
                            <button class="btn btn-success" onclick="checkUpdates()">
                              <i class="bx bx-update me-1"></i>Kiểm tra cập nhật
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;

      // Render layout khi trang load
      document.addEventListener('DOMContentLoaded', function() {
        CommonUtils.checkLoginStatus();
        layoutManager.renderLayout('app-layout', pageContent);
        loadSystemInfo();
        loadSettings();
      });

      // Load system information
      async function loadSystemInfo() {
        try {
          await CommonUtils.loadSites();
          document.getElementById('totalSites').textContent = CommonUtils.sites.length;
          
          // Simulate uptime
          document.getElementById('uptime').textContent = '2 ngày 5 giờ';
          document.getElementById('totalData').textContent = '1,234 sản phẩm';
        } catch (error) {
          console.error('Error loading system info:', error);
        }
      }

      // Load settings
      function loadSettings() {
        // Load from localStorage or use defaults
        const generalSettings = CommonUtils.getStorage('generalSettings', {
          appName: 'Tool Craw Data Đa Luồng',
          language: 'vi',
          timezone: 'Asia/Ho_Chi_Minh',
          dateFormat: 'dd/mm/yyyy'
        });

        const crawlerSettings = CommonUtils.getStorage('crawlerSettings', {
          maxPages: 5,
          perPage: 20,
          retryCount: 3,
          timeout: 30,
          orderBy: 'date',
          order: 'desc'
        });

        // Populate forms
        Object.keys(generalSettings).forEach(key => {
          const element = document.getElementById(key);
          if (element) element.value = generalSettings[key];
        });

        Object.keys(crawlerSettings).forEach(key => {
          const element = document.getElementById(key);
          if (element) element.value = crawlerSettings[key];
        });
      }

      // Save general settings
      document.getElementById('generalSettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const settings = {
          appName: document.getElementById('appName').value,
          language: document.getElementById('language').value,
          timezone: document.getElementById('timezone').value,
          dateFormat: document.getElementById('dateFormat').value
        };

        CommonUtils.setStorage('generalSettings', settings);
        CommonUtils.showAlert('Đã lưu cài đặt chung!', 'success');
      });

      // Save crawler settings
      document.getElementById('crawlerSettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const settings = {
          maxPages: parseInt(document.getElementById('maxPages').value),
          perPage: parseInt(document.getElementById('perPage').value),
          retryCount: parseInt(document.getElementById('retryCount').value),
          timeout: parseInt(document.getElementById('timeout').value),
          orderBy: document.getElementById('orderBy').value,
          order: document.getElementById('order').value
        };

        CommonUtils.setStorage('crawlerSettings', settings);
        CommonUtils.showAlert('Đã lưu cài đặt crawler!', 'success');
      });

      // Cleanup data
      function cleanupData() {
        if (!confirm('Bạn có chắc chắn muốn dọn dẹp dữ liệu? Hành động này không thể hoàn tác!')) {
          return;
        }

        CommonUtils.showAlert('Đang dọn dẹp dữ liệu...', 'info');
        
        // Simulate cleanup
        setTimeout(() => {
          CommonUtils.showAlert('Đã dọn dẹp dữ liệu thành công!', 'success');
        }, 2000);
      }

      // Backup data
      function backupData() {
        CommonUtils.showAlert('Đang tạo sao lưu...', 'info');
        
        // Simulate backup
        setTimeout(() => {
          CommonUtils.showAlert('Đã tạo sao lưu thành công!', 'success');
        }, 2000);
      }

      // Restart system
      function restartSystem() {
        if (!confirm('Bạn có chắc chắn muốn khởi động lại hệ thống?')) {
          return;
        }

        CommonUtils.showAlert('Đang khởi động lại hệ thống...', 'warning');
        
        // Simulate restart
        setTimeout(() => {
          window.location.reload();
        }, 3000);
      }

      // Check updates
      function checkUpdates() {
        CommonUtils.showAlert('Đang kiểm tra cập nhật...', 'info');
        
        // Simulate update check
        setTimeout(() => {
          CommonUtils.showAlert('Hệ thống đã được cập nhật lên phiên bản mới nhất!', 'success');
        }, 2000);
      }
    </script>
  </body>
</html>
